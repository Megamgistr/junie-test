# API Documentation Generator
name: Update API Docs

on:
  push:
    branches:
      - main
    paths:
      - 'src/routes/**'
      - 'src/controllers/**'
      - 'src/api/**'

jobs:
  generate-docs:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pull-requests: write
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - uses: JetBrains/junie-github-action@v0
        with:
          junie_api_key: ${{ secrets.JUNIE_API_KEY }}
          create_new_branch_for_pr: "true"
          base_branch: "main"
          prompt: |
            API code changed. Update API documentation.

            **Scan routes:** src/routes/**, src/controllers/**, src/api/**

            **Extract for each endpoint:**
            - HTTP method, path with params
            - Request body schema (TS types/JSDoc)
            - Response schema, status codes
            - Auth requirements
            - Description from comments

            **Update docs/openapi.yaml:**
            - Add new endpoints
            - Update changed schemas
            - Mark removed as deprecated (don't delete)
            - Keep existing examples

            **Update docs/API.md:**
            - Group by resource (Users, Posts, etc.)
            - Include example requests/responses
            - Document error codes
            - Add auth section

            **Quality checks:**
            - All endpoints have descriptions
            - Types documented
            - Realistic examples
            - Enums listed
