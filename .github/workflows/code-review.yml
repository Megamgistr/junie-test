# Automated Code Review
name: Code Review

on:
  pull_request:
    types: [opened, synchronize]

jobs:
  review:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      pull-requests: write
      issues: write
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 1

      - uses: JetBrains/junie-github-action@main
        with:
          junie_api_key: ${{ secrets.JUNIE_API_KEY }}
          use_single_comment: "true"
          prompt: |
            Review pr diff for:

            **Security:**
            - SQL injection, XSS, exposed secrets
            - Authentication/authorization issues
            - Input validation vulnerabilities

            **Performance:**
            - N+1 queries, memory leaks
            - Inefficient algorithms (nested loops, etc.)
            - Blocking operations

            **Code Quality:**
            - Complexity, duplication, naming
            - Missing tests for new logic
            - Undocumented complex logic

            **Provide structured feedback:**
            ## üéØ Summary
            [2-3 sentences overall assessment]

            ## ‚ö†Ô∏è Issues Found
            [Each issue: File:line, Severity (Critical/High/Medium/Low), Description, Suggested fix with code example]

            ## ‚ú® Highlights
            [1-2 things done well]

            ## üìã Checklist
            - [ ] Security: No vulnerabilities
            - [ ] Tests: Adequate coverage
            - [ ] Performance: No bottlenecks
            - [ ] Documentation: Complex logic explained
            
            Procedure:
            Use gh pr diff ${{ github.event.pull_request.head.ref }} to get a diff of the PR. 
            
            Only provide feedback without modifying files.
